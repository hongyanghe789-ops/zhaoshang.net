# 载体发布反馈数据 - 产品需求文档（PRD）

## 一、文档信息

| 项目 | 说明 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-02-24 |
| 所属模块 | 载体管理 |
| 功能定位 | 数据反馈与分析 |
| 优先级 | P0（高） |

---

## 二、功能概述

### 2.1 核心价值

在载体发布到招商网络平台（www.zhaoshang.net）后，系统需要实时回传载体在平台上的表现数据，帮助招商人员评估发布效果，优化载体信息，提升去化率。

**这是从"单向发布"到"双向反馈"的升级，让载体管理从"盲目发布"变为"数据驱动"。**

### 2.2 业务场景

**场景1：评估发布效果**
- 招商人员发布了10套房源，一周后想知道哪些房源最受关注
- 通过查看PV/UV、IM咨询数、收藏量等数据，快速识别"热门房源"
- 对于低关注度房源，及时调整价格、描述或图片

**场景2：优化营销策略**
- 发现某房源浏览量高但咨询量低，说明价格可能过高或描述不清晰
- 发现某房源收藏量高但成交慢，可以主动联系收藏用户进行促成

**场景3：数据化汇报**
- 向领导汇报时，不再说"发布了多少房源"，而是说"发布的房源累计获得XX次浏览，XX次咨询"
- 用数据证明招商工作的成效

---

## 三、功能详细设计

### 3.1 载体列表新增反馈字段

#### 3.1.1 字段列表

在"载体发布"列表中，新增以下字段：

| 字段名称 | 字段说明 | 数据来源 | 展示位置 | 排序支持 |
|---------|---------|---------|---------|---------|
| 浏览量（PV） | 载体详情页累计访问次数 | 招商网络平台API | 列表列 | 支持 |
| 访客数（UV） | 载体详情页独立访客数 | 招商网络平台API | 列表列 | 支持 |
| IM咨询数 | 通过该载体发起的IM对话数量 | 招商网络平台API | 列表列 | 支持 |
| 电话拨打数 | 点击拨打招商人电话的次数 | 招商网络平台API | 列表列 | 支持 |
| 收藏量 | 用户收藏该载体的次数 | 招商网络平台API | 列表列 | 支持 |
| 点击量 | 载体卡片在列表中的点击次数 | 招商网络平台API | 列表列 | 支持 |
| 转化率 | IM咨询数 / 浏览量（UV） × 100% | 系统计算 | 列表列 | 支持 |
| 最后更新时间 | 反馈数据最后同步时间 | 系统记录 | 列表列 | 支持 |

#### 3.1.2 字段展示规则

**默认展示：**
- 浏览量（PV/UV合并展示：1,234 / 567）
- IM咨询数
- 收藏量
- 转化率

**可选展示（通过列配置）：**
- 电话拨打数
- 点击量
- 最后更新时间

**数据格式：**
- 数量类：使用千分位分隔符（如：1,234）
- 百分比类：保留1位小数（如：3.5%）
- 时间类：yyyy-MM-dd HH:mm

#### 3.1.3 筛选与排序

**筛选条件：**
- 浏览量范围筛选（如：0-100、100-500、500-1000、1000+）
- IM咨询数范围筛选
- 收藏量范围筛选
- 转化率范围筛选（如：<1%、1%-3%、3%-5%、>5%）

**排序功能：**
- 支持按任意反馈字段升序/降序排序
- 默认按"浏览量"降序排列

**快捷筛选标签：**
- "热门房源"（浏览量 > 500 或 IM咨询数 > 10）
- "待优化房源"（浏览量 > 100 且 转化率 < 1%）
- "零关注房源"（发布超过7天 且 浏览量 = 0）

---

### 3.2 载体详情页数据展示

#### 3.2.1 数据概览卡片

在载体详情页顶部，增加"平台反馈数据"卡片：

```
┌─────────────────────────────────────────────────────────────┐
│  📊 平台反馈数据（数据来源：招商网络平台）                      │
├─────────────────────────────────────────────────────────────┤
│  浏览量：1,234 (PV)  |  访客数：567 (UV)  |  转化率：3.5%      │
│  IM咨询：20次  |  电话拨打：8次  |  收藏：12次              │
│  最后更新：2026-02-24 14:30                                  │
│                                                             │
│  [查看详细数据趋势] [刷新数据]                                │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.2 数据趋势图

点击"查看详细数据趋势"后，弹出抽屉式面板，展示：

**时间维度选择：**
- 近7天
- 近30天
- 近90天
- 自定义时间范围

**趋势图表：**
1. **流量趋势图**（折线图）
   - X轴：日期
   - Y轴：浏览量（PV/UV）
   - 展示每日流量变化

2. **互动趋势图**（柱状图）
   - X轴：日期
   - Y轴：IM咨询数、电话拨打数、收藏量
   - 多系列对比展示

3. **转化漏斗图**
   ```
   点击量（1,500） → 浏览量（1,234） → IM咨询（20） → 成交（2）
       82.3%              1.6%           10.0%
   ```

---

### 3.3 数据同步机制

#### 3.3.1 API对接方案

**接口定义：**
```
GET /api/carrier/feedback
请求参数：
{
  "carrierId": "载体ID",
  "startDate": "2026-02-01",
  "endDate": "2026-02-24",
  "metrics": ["pv", "uv", "im", "call", "favorite", "click"]
}

响应示例：
{
  "code": 200,
  "data": {
    "summary": {
      "pv": 1234,
      "uv": 567,
      "imCount": 20,
      "callCount": 8,
      "favoriteCount": 12,
      "clickCount": 1500
    },
    "trend": [
      {"date": "2026-02-01", "pv": 45, "uv": 23, "imCount": 1, ...},
      {"date": "2026-02-02", "pv": 52, "uv": 28, "imCount": 2, ...},
      ...
    ],
    "lastUpdateTime": "2026-02-24 14:30:00"
  }
}
```

#### 3.3.2 同步策略

**实时同步：**
- 当用户在载体详情页点击"刷新数据"时，立即调用API获取最新数据
- 同步结果存储到本地数据库，并更新"最后更新时间"

**定时同步：**
- 系统每天凌晨2点，自动批量同步所有已发布载体的反馈数据
- 同步失败的载体，记录到"同步失败日志"，并在工作台提醒管理员

**增量同步：**
- 每次同步只拉取自"上次同步时间"后的增量数据
- 减少API调用压力和数据传输量

#### 3.3.3 异常处理

**API调用失败：**
- 重试3次（间隔5秒）
- 仍失败则记录错误日志，并在界面提示："暂时无法获取平台数据，请稍后重试"

**数据异常（如负数、超大值）：**
- 记录警告日志
- 界面显示"数据异常"，并提供"联系客服"入口

**载体未发布：**
- 反馈数据字段显示"--"或"未发布"
- 不展示"平台反馈数据"卡片

---

## 四、数据库设计

### 4.1 新增表：carrier_feedback（载体反馈数据表）

| 字段名 | 类型 | 说明 | 索引 |
|-------|------|------|------|
| id | bigint | 主键ID | PK |
| carrier_id | bigint | 载体ID | INDEX |
| record_date | date | 数据记录日期 | INDEX |
| pv | int | 浏览量（PV） | - |
| uv | int | 访客数（UV） | - |
| im_count | int | IM咨询数 | - |
| call_count | int | 电话拨打数 | - |
| favorite_count | int | 收藏量 | - |
| click_count | int | 点击量 | - |
| conversion_rate | decimal(5,2) | 转化率（%） | - |
| sync_time | datetime | 同步时间 | - |
| created_at | datetime | 创建时间 | - |
| updated_at | datetime | 更新时间 | - |

**索引设计：**
- 联合索引：(carrier_id, record_date) - 用于查询特定载体的时间范围数据
- 单列索引：carrier_id - 用于查询载体的最新反馈数据

### 4.2 carrier（载体表）扩展字段

| 字段名 | 类型 | 说明 |
|-------|------|------|
| total_pv | int | 累计浏览量 |
| total_uv | int | 累计访客数 |
| total_im_count | int | 累计IM咨询数 |
| total_call_count | int | 累计电话拨打数 |
| total_favorite_count | int | 累计收藏量 |
| total_click_count | int | 累计点击量 |
| avg_conversion_rate | decimal(5,2) | 平均转化率 |
| last_feedback_sync_time | datetime | 最后反馈同步时间 |

**说明：** 这些字段用于快速展示列表数据，避免每次都需要聚合计算。

---

## 五、交互设计要点

### 5.1 列表页交互

**数据加载：**
- 首次加载列表时，优先展示基础字段（名称、地址、状态等）
- 反馈数据字段通过异步加载，避免阻塞页面渲染
- 加载中显示骨架屏或加载动画

**数据高亮：**
- 转化率 > 5%：显示绿色，并标注"🔥 高转化"
- 转化率 < 1% 且 浏览量 > 100：显示橙色，并标注"⚠️ 待优化"
- 浏览量 = 0 且 发布时间 > 7天：显示红色，并标注"❌ 零关注"

**快捷操作：**
- 鼠标悬停在反馈数据上，显示tooltip："点击查看详细趋势"
- 点击数据后，直接跳转到载体详情页的"平台反馈数据"卡片

### 5.2 详情页交互

**数据刷新：**
- 点击"刷新数据"按钮，显示loading状态
- 刷新成功后，弹出toast提示："数据已更新"
- 如果数据无变化，提示："当前已是最新数据"

**趋势图交互：**
- 支持点击图例，隐藏/显示特定数据系列
- 鼠标悬停在数据点上，显示详细数值
- 支持拖拽缩放时间范围

### 5.3 权限控制

**查看权限：**
- 具有"载体管理-查看"权限的用户，可以查看反馈数据
- 不具备权限的用户，看不到反馈数据字段

**刷新权限：**
- 具有"载体管理-编辑"权限的用户，可以手动刷新数据
- 普通查看用户只能看到定时同步的数据

---

## 六、业务价值分析

### 6.1 对招商人员的价值

1. **数据化决策**
   - 不再凭感觉判断哪些房源受欢迎
   - 用数据指导载体信息优化

2. **提升转化率**
   - 快速识别"高浏览低咨询"的房源，主动调整策略
   - 对"高收藏"用户进行针对性跟进

3. **工作成果可视化**
   - 向上级汇报时，用具体数据说话
   - 提升工作满意度和成就感

### 6.2 对管理者的价值

1. **团队绩效评估**
   - 根据反馈数据，评估各招商人员的载体发布质量
   - 识别优秀案例，进行经验推广

2. **资源优化配置**
   - 对"零关注房源"进行专项分析，找出问题所在
   - 调整载体组合策略，提升整体去化率

3. **数据驱动运营**
   - 基于历史数据，预测未来招商趋势
   - 为业务决策提供数据支撑

### 6.3 商业化价值

1. **增强产品竞争力**
   - "双向反馈"是行业首创功能
   - 形成从"发布"到"反馈"到"优化"的完整闭环

2. **提升客户付费意愿**
   - 客户能看到实实在在的数据价值
   - 愿意为"数据驱动"的产品付费

3. **为高级功能铺路**
   - 未来可基于反馈数据，提供"智能定价建议"、"载体优化建议"等增值服务
   - 构建数据分析产品线

---

## 七、技术实现要点

### 7.1 性能优化

**列表查询优化：**
- 反馈数据字段通过冗余存储在carrier表，避免JOIN查询
- 使用Redis缓存热门载体的反馈数据（TTL: 1小时）

**批量同步优化：**
- 使用消息队列（如RabbitMQ）进行异步同步
- 每次批量同步500条载体，避免API限流
- 同步失败的载体，自动加入重试队列

**趋势图查询优化：**
- 按天聚合的数据，直接从carrier_feedback表查询
- 按周/月聚合的数据，通过SQL聚合计算
- 查询结果缓存30分钟

### 7.2 数据一致性

**最终一致性：**
- 反馈数据不要求强一致性，允许几分钟的延迟
- 通过定时同步 + 手动刷新，保证数据最终一致

**数据校验：**
- 同步时，校验数据的合理性（如：UV不应大于PV）
- 异常数据记录警告日志，不入库

### 7.3 监控与告警

**同步监控：**
- 监控API调用成功率、响应时间
- 同步失败率 > 5% 时，发送告警通知

**数据监控：**
- 监控载体发布后的首次数据同步时间
- 超过24小时未同步的载体，发送提醒

---

## 八、后续迭代方向

### 8.1 V1.1版本（3个月后）

**智能预警：**
- 当载体发布后7天浏览量为0，自动提醒招商人员检查信息
- 当转化率突然下降（如从5%降到1%），发送异常告警

**数据对比：**
- 支持多个载体的反馈数据对比
- 支持同类载体的平均值对比（如：同区域、同面积、同价格区间）

### 8.2 V1.2版本（6个月后）

**智能推荐：**
- 基于反馈数据，推荐"最佳发布时间"
- 基于浏览行为，推荐"相似房源"给用户

**用户画像：**
- 分析浏览该载体的用户画像（行业、规模、地域）
- 为招商人员提供精准营销建议

### 8.3 V2.0版本（12个月后）

**AI辅助优化：**
- 基于历史数据，AI自动生成"载体优化建议"
- 如："建议将价格从5.0元/㎡/天调整为4.5元，预计可提升咨询量30%"

**数据大屏：**
- 为管理者提供"载体发布效果大屏"
- 实时展示全公司载体的发布效果数据

---

## 九、验收标准

### 9.1 功能验收

- [ ] 载体列表正确展示反馈数据字段
- [ ] 支持按反馈数据筛选和排序
- [ ] 载体详情页正确展示反馈数据卡片
- [ ] 趋势图正确展示历史数据
- [ ] 手动刷新功能正常工作
- [ ] 定时同步功能正常工作

### 9.2 性能验收

- [ ] 列表页加载时间 < 2秒（1000条数据）
- [ ] 详情页反馈数据加载时间 < 1秒
- [ ] 趋势图渲染时间 < 1秒（90天数据）
- [ ] API调用成功率 > 99%

### 9.3 用户体验验收

- [ ] 数据展示清晰易懂
- [ ] 交互流畅，无明显卡顿
- [ ] 异常情况有友好提示
- [ ] 权限控制准确无误

---

## 十、附录

### 10.1 名词解释

- **PV（Page View）**：页面浏览量，即载体详情页被访问的总次数
- **UV（Unique Visitor）**：独立访客数，即访问载体详情页的独立用户数
- **转化率**：IM咨询数 / UV，反映载体信息对用户的吸引力
- **热门房源**：浏览量或咨询量超过一定阈值的房源
- **零关注房源**：发布一定时间后仍无浏览量的房源

### 10.2 参考文档

- 《载体发布.pdf》 - 现有载体发布功能文档
- 《载体列表.pdf》 - 现有载体列表功能文档
- 《招商网络平台API文档》 - 平台接口文档

---

**文档结束**
